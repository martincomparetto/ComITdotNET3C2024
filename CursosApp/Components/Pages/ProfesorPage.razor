@page "/profesor"
@using ComIT.Comunes.Entities
@rendermode InteractiveServer

<h1>Profesor</h1>

<h3>Nuevo profesor</h3>
<label>
    DNI
    <input type="number" @bind="DNI" />
</label>
<label>
    Nombre
    <input type="text" @bind="Nombre" />
</label>
<label>
    Apellido
    <input type="text" @bind="Apellido" />
</label>
<label>
    Fecha nacimiento
    <input type="date" @bind="FechaNacimiento" />
</label>
<label>
    Años experiencia
    <input type="number" @bind="AñosExperiencia" />
</label>
<label>
    Materia
    <input type="text" @bind="Materia" />
</label>

@if (EstamosModificando)
{
    <button type="button" class="btn btn-primary" @onclick="GuardarCambios">Guardar Cambios</button>
}
else
{
    <button type="button" class="btn btn-primary" @onclick="Agregar">Agregar profesor</button>
}
<br />

@if (MensajeError != "")
{
    <label style="background-color: red;">@MensajeError</label>
}

<table class="table table-striped table-hover">
    <thead>
        <tr>
            @* <th>#</th> *@
            <th>DNI</th>
            <th>Nombre</th>
            <th>Apellido</th>
            <th>Fecha nacimiento</th>
            <th>Años experiencia</th>
            <th>Materia</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in ProfesoresList)
        {
            <tr>
                <td>@item.DNI</td>
                <td>@item.Nombre</td>
                <td>@item.Apellido</td>
                <td>@item.FechaNacimiento</td>
                <td>@item.AñosExperiencia</td>
                <td>@item.Materia</td>
                <td>
                    <button type="button" class="btn btn-link" @onclick="() => Modificar(item)">Modificar</button>
                    <button type="button" class="btn btn-link" @onclick="() => Eliminar(item)">Eliminar</button>
                </td>
            </tr>
        }
    </tbody>
</table>

<p>Cantidad de profesores: @CantidadProfesores</p>

@code {
    private int CantidadProfesores = 0;
    private string MensajeError = "";
    private bool EstamosModificando = false;
    private Profesor? ProfesorModificando;

    private long DNI = 0;
    private string Nombre = "";
    private string Apellido = "";
    private DateOnly? FechaNacimiento;
    private int AñosExperiencia = 0;
    private string Materia = "";

    private List<Profesor> ProfesoresList = new();

    private void Agregar()
    {
        if (DNI == 0 || Nombre == "" || Apellido == "" || FechaNacimiento == null)
        {
            MensajeError = "No se ingresaron todos los datos del profesor";
        }
        else
        {
            ProfesoresList.Add(new Profesor(DNI, Nombre, Apellido, (DateOnly)FechaNacimiento, AñosExperiencia, Materia));

            DNI = 0;
            Nombre = "";
            Apellido = "";
            FechaNacimiento = null;
            AñosExperiencia = 0;
            Materia = "";

            CantidadProfesores++;
            MensajeError = "";
        }
    }

    private void Modificar(Profesor profesorModificar)
    {
        EstamosModificando = true;
        ProfesorModificando = profesorModificar;

        DNI = profesorModificar.DNI;
        Nombre = profesorModificar.Nombre;
        Apellido = profesorModificar.Apellido;
        FechaNacimiento = profesorModificar.FechaNacimiento;
        AñosExperiencia = profesorModificar.AñosExperiencia;
        Materia = profesorModificar.Materia;
    }

    private void GuardarCambios()
    {
        if (DNI == 0 || Nombre == "" || Apellido == "" || FechaNacimiento == null)
        {
            MensajeError = "No se ingresaron todos los datos del profesor";
        }
        else
        {
            ProfesorModificando.DNI = DNI;
            ProfesorModificando.Nombre = Nombre;
            ProfesorModificando.Apellido = Apellido;
            ProfesorModificando.FechaNacimiento = (DateOnly)FechaNacimiento;
            ProfesorModificando.AñosExperiencia = AñosExperiencia;
            ProfesorModificando.Materia = Materia;

            DNI = 0;
            Nombre = "";
            Apellido = "";
            FechaNacimiento = null;
            AñosExperiencia = 0;
            Materia = "";

            EstamosModificando = false;
            ProfesorModificando = null;
        }
    }

    private void Eliminar(Profesor profesorEliminar)
    {
        ProfesoresList.Remove(profesorEliminar);
        CantidadProfesores--;
    }
}
